{
    "contents" : "---\ntitle: \"Analysis of NOCA storm data to determine the leading event causes of human and financial impact\"\nauthor: \"Peter Warren\"\ndate: \"Saturday, November 22, 2014\"\noutput: html_document\n---\n\n## Synopsis\nThe National Oceanic and Atmospheric Administration maintain a storm database, which collects a range of data describing the impact from different types of natural events. This analysis reviews both the financial and human impact attributed to different event type. \n\nThe data suggests large proportions of the financial and human impact from natural events are the result of a disproportionately small number of event types. The leading contributors to financial damage are Floods, hurricanes/typhoons and tornadoes account. While the single largest cause of injuries and fatalities are tornadoes.\n\n\n## Data Processing\n### Load required Librarys\n\nThe following librarys are used to analysis the data and produce this report. Hence, they must be loaded first.\n\n```{r echo = TRUE, message=FALSE}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(reshape2)\n```\n\n### Load storm data into R\n\nLoad the National Oceanic and Atmospheric Administration's (NOAA) storm data into R. The data are stored in a comma separated  value format, which is compressed with bz2. \n\nAll data are first read into a dataframe. The dataframe size is reduced by selecting only the columns required for the analysis. The dataframe size is further reduced by filtering rows containing all zero values (i.e. no fatality, injury, or damage values). \n\n```{r echo = TRUE, cache=TRUE}\nfileHandle <- \"repdata-data-StormData.csv.bz2\"\nstormData <-read.csv(bzfile(fileHandle))\n\n# Reduce dataframe by selection only required follows and rows with non-zero values\ncolumnsRequired <- c(\"EVTYPE\", \"FATALITIES\", \"INJURIES\", \"PROPDMG\", \"PROPDMGEXP\", \"CROPDMG\", \"CROPDMGEXP\")\nrowsRequired <- stormData$PROPDMG != 0 | stormData$CROPDMG != 0 | stormData$FATALITIES != 0 | stormData$INJURIES != 0\n\nstormData <- subset(stormData, rowsRequired, select=columnsRequired)\n```\n\n### Clean Event Type data\n\nThe event type data are maintained in the EVTYPE column. The EVTYPE data contains a significant number of descriptions where different case was used. In addition, many similar event type descriptions are in the data. For example, hail is reported as 'HAIL 125', 'HAIL 150', 'HAIL 175', etc. \n\nEvent type data was homogenized to ensure significant of observations are not defused across a large number related categories. CAUTION: Subjective judgement was exercised to determine the level of similarity. For example, are 'flash floods' significantly different to a 'flood'?\n\n\nThe Top 10 event types BEFORE cleaning the EVTYPE descriptions are:\n\n```{r echo = TRUE}\nsort(table(stormData$EVTYPE),decreasing = TRUE)[1:10]\n```\n\nAnd the initial number of factor levels in EVTYPE are:\n\n```{r echo = TRUE}\n# Number of factor levels BEFORE cleaning data\nlength(levels(stormData$EVTYPE))\n```\n\nThe first step of cleaning the EVTYPE data was to convert all characters to UPPERCASE. The level of factors was reduced from 985 to 447 in this step.\n\n#### Converting to UPPERCASE\nConverting all EVTYPE descriptions in UPPERCASE reduced the number of factor levels to:\n\n```{r echo = TRUE}\n# Convert all EVTYPE value to UPPERCASE. This step reduces the EVTYPE factors by \nstormData$EVTYPE <- as.factor(toupper(stormData$EVTYPE))\nlength(levels(stormData$EVTYPE))\n```\n\n#### Further Grouping\n\nFurther reduction was achieved through a limited number of character substitutions. An 80/20 approach was employed to apply the remaining groupings. The focus was on grouping variants that might affect the final Top 10 event type by occurrence.\n\n```{r echo = TRUE}\n# Remove leading whitespace\nstormData$EVTYPE <- as.factor(sub(pattern = \"^[ \\t]+\", replacement = \"\",stormData$EVTYPE))\n\n# Further reduce namespace\nstormData$EVTYPE <- as.factor(sub(pattern = \"TSTM WIND.*\", replacement = \"THUNDERSTORM WIND\",stormData$EVTYPE))\nstormData$EVTYPE <- as.factor(sub(pattern = \"THUNDERSTORM WIND.*\", replacement = \"THUNDERSTORM WIND\",stormData$EVTYPE))\nstormData$EVTYPE <- as.factor(sub(pattern = \"HAIL .*\", replacement = \"HAIL\",stormData$EVTYPE))\nstormData$EVTYPE <- as.factor(sub(pattern = \"TORNADO .*\", replacement = \"TORNADO\",stormData$EVTYPE))\nstormData$EVTYPE <- as.factor(sub(pattern = \"HIGH WIND.*\", replacement = \"HIGH WIND\",stormData$EVTYPE))\n```\n\nThe Top 10 event types AFTER cleaning the EVTYPE descriptions are:\n\n```{r echo = TRUE}\nsort(table(stormData$EVTYPE),decreasing = TRUE)[1:10]\n```\n\nAs a result, the number of factor levels AFTER cleaning the EVTYPE data are:\n\n```{r echo = TRUE}\nlength(levels(stormData$EVTYPE))\n```\n\n\n### Calculate Property and Crop damage cost\n\nThe property and crop damage data are each recorded in two component values. The first component records the damage estimate rounded to 3 significant digits and the second component reports the magnitude of the estimate. The magnitude describes the number of 0s behind the estimate. For example, a damage estimate of 7.23 with magnitude 4 equates to $72300.\n\nThe magnitude data contains character data in addition to numerical values. These character values denote shorthand values for common magnitudes (e.g. k = 1,000, m = 1,000,000, etc.). Therefore, in order to create a single column for each type of damage estimate (i.e. crop and property), the characters values must be replaces.\n\n#### Property Damage\nThe initial values for the property damage magnitude BEFORE cleaning data are:\n\n```{r echo = TRUE}\ntable(stormData$PROPDMGEXP)\n```\n\nThe follow substitutions are applied to the property damage magnitude data\n\n```{r echo = TRUE}\nstormData$PROPDMGEXP <- sub(pattern = \"h\", replacement = \"2\",stormData$PROPDMGEXP , ignore.case = TRUE)\nstormData$PROPDMGEXP <- sub(pattern = \"k\", replacement = \"3\",stormData$PROPDMGEXP , ignore.case = TRUE)\nstormData$PROPDMGEXP <- sub(pattern = \"m\", replacement = \"6\",stormData$PROPDMGEXP , ignore.case = TRUE)\nstormData$PROPDMGEXP <- sub(pattern = \"b\", replacement = \"9\",stormData$PROPDMGEXP , ignore.case = TRUE)\nstormData$PROPDMGEXP <- sub(pattern = \"[^1-9]\", replacement = \"0\",stormData$PROPDMGEXP)\nstormData$PROPDMGEXP <- sub(pattern = \"[?]\", replacement = \"0\",stormData$PROPDMGEXP)\nstormData$PROPDMGEXP <- as.numeric(stormData$PROPDMGEXP)\n```\n\nThe resultant property damage magnitude data AFTER cleaning are:\n\n```{r echo = TRUE}\ntable(stormData$PROPDMGEXP)\n```\n\nFinal step is to calculate the new measure PROPDamage, which is the combination of the PROPDMG and PROPDMGEXP data.\n\n```{r echo = TRUE}\nstormData$PROPDamage <- stormData$PROPDMG * (10 ^ stormData$PROPDMGEXP)\n```\n\n#### Crop Damage\nThe initial values for the crop damage magnitude BEFORE cleaning data are:\n\n```{r echo = TRUE}\ntable(stormData$CROPDMGEXP)\n```\n\nThe follow substitutions are applied to the crop damage magnitude data\n\n```{r echo = TRUE}\nstormData$CROPDMGEXP <- sub(pattern = \"h\", replacement = \"2\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- sub(pattern = \"k\", replacement = \"3\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- sub(pattern = \"m\", replacement = \"6\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- sub(pattern = \"b\", replacement = \"9\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- sub(pattern = \"[^1-9]\", replacement = \"0\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- sub(pattern = \"[?]\", replacement = \"0\",stormData$CROPDMGEXP , ignore.case = TRUE)\nstormData$CROPDMGEXP <- as.numeric(stormData$CROPDMGEXP)\n```\n\nThe resultant crop damage magnitude data AFTER cleaning are:\n\n```{r echo = TRUE}\ntable(stormData$CROPDMGEXP)\n```\n\nFinal step is to calculate the new measure PROPDamage, which is the combination of the PROPDMG and PROPDMGEXP data.\n\n```{r echo = TRUE}\nstormData$CROPDamage <- stormData$CROPDMG * (10 ^ stormData$CROPDMGEXP)\n```\n\n## Results\n### Analysis of Financal Impact\n\nIn the dataset, crop and property values are maintained in unrelated columns. The damage estimates in these fields need to be merge, so that the total financial impact of each event type can be assessed. However, it is useful to maintain which measure the merged values is derived from. The *melt()* function reshape2 package is extremely useful for this purpose.\n\n```{r echo = TRUE}\ndamageData <- melt(data = stormData, id.vars = c(\"EVTYPE\"), measure.vars = c(\"CROPDamage\", \"PROPDamage\"), na.rm = TRUE)\n```\n\nNext the damage data are aggregated to the sum of all damage estimates versus event type and the estimate source (i.e. crop and property). \n\n```{r echo = TRUE}\ntotalDamageData <- aggregate(value ~ EVTYPE + variable, data=damageData, FUN = sum)\n```\n\nA review of the damage estimate data notes a mean of:\n\n```{r echo = TRUE}\nmean(totalDamageData$value)\n```\n\nThe damage estimate data mean is used to select a minimum level significance for the data. The mean value is rounded down and only events resulting in damages of greater than $1,000,000,000 are maintained for further analysis.\n\n```{r echo = TRUE}\n# Mean is 1,092,286,179\ntotalDamageData <- filter(totalDamageData, value > 1e9)\n```\n\nThe resultant event types where either crop or property damage greater than 1 billion dollars are:\n\n```{r echo = TRUE}\narrange(totalDamageData, desc(value))\n```\n\nThe damage estimates for crop and property are illustrated on the below chart. It is evident from the chart that:\n\n1. The financial impact from property damage is higher than crops damage\n2. 'Flood' events have the highest financial impact of all event types\n3. 'Flood' events caused approximately $144 billion of property damage, which is the largest contributor to property damage. The next highest event type is 'HURRICANE/TYPHOON' at $69 billion.\n4. 'Drought' is the largest contributor to crop damage at almost $14 billion. This is more than twice the estimated damage to crops than from 'Flood' at $5.6 billion.\n\nIMPORTANT NOTE: The y-axis does not use a linear scale. A SQRT transformation is used to improve readability.\n\n```{r echo = TRUE}\nfigure1 <- ggplot(totalDamageData, aes(x=EVTYPE, y=value/1e9, fill=variable)) + \n    geom_bar(stat=\"identity\") +\n    theme(axis.text.x = element_text(angle=90), plot.title = element_text(face=\"bold\")) +\n    scale_x_discrete(name=\"Event Type\") +\n    scale_y_sqrt(name = \"Damage estimates in billions ($)\") +\n    ggtitle(\"Crop and Property damage by Event Type\")\n\nfigure1\n\n```\n\n\n### Calculate Human total\nSimilar to the financial impact analysis, fatality and injury values are maintained in unrelated columns. As before, these data are merged to support the assessment of total human impact from each event type.\n\n```{r echo = TRUE}\nhumanData <- melt(data = stormData, id.vars = c(\"EVTYPE\"), measure.vars = c(\"FATALITIES\", \"INJURIES\"), na.rm = TRUE)\n```\n\nNext the human impact data are aggregated to sum all fatalities and injuries versus event type and the estimate source (i.e. crop and property). \n\nAn additional step is used for the human impact analysis. All zero values are filtered from the dataset before the mean is calculated. A much larger property of the human impact data has zero values than the damage data. Filtering the zero data results in a larger mean. However, this does not change the outcome of the analysis. The mean simply informs the decision to where the minimum threshold for reporting in our data.\n\n```{r echo = TRUE}\ntotalHumanData <- aggregate(value ~ EVTYPE + variable, data=humanData, FUN = sum)\ntotalHumanData <- filter(totalHumanData, value > 0) \n```\n\nA review of the human impact data notes a mean of:\n\n```{r echo = TRUE}\nmean(totalHumanData$value)\n```\n\nThe human impact data mean is used to select a minimum level significance for the data. The mean value is rounded and only events resulting in more than 550 fatalities or injuries are maintained for further analysis.\n\n```{r echo = TRUE}\n# Mean is 1,092,286,179\ntotalHumanData <- filter(totalHumanData, value > 550) \n```\n\nThe resultant event types where either fatalities or injuries are greater than 550 are:\n\n```{r echo = TRUE}\narrange(totalHumanData, desc(value))\n```\n\nThe fatality and injury impacts are illustrated on the below chart. It is evident from the chart that:\n\n1. Injuries occur more often than fatalities\n2. 'Tornado' events are the leading cause of injuries and fatalities. \n3. Injuries attributed to 'Tornado' are almost 10 times greater than the second largest category 'Thunderstorm Wind' \n\nIMPORTANT NOTE: The y-axis does not use a linear scale. A SQRT transformation is used to improve readability.\n\n```{r echo = TRUE}\n\n\nfigure2 <- ggplot(totalHumanData, aes(x=EVTYPE, y=value, fill=variable)) + \n    geom_bar(stat=\"identity\") +\n    theme(axis.text.x = element_text(angle=90), plot.title = element_text(face=\"bold\")) +\n    scale_x_discrete(name=\"Event Type\") +\n    scale_y_sqrt(name = \"Injuries and Fatalities\") +\n    #scale_y_continuous(name = \"Injuries and Fatalities\") +\n    ggtitle(\"Injuries and Fatalities by Event Type\")\n\nfigure2\n\n```\n\n\n\n",
    "created" : 1416632244071.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "152952694",
    "id" : "CB1CD31",
    "lastKnownWriteTime" : 1416895932,
    "path" : "H:/GitHub/RepData_PeerAssessment2/Reprod_Research_Assignment2.Rmd",
    "project_path" : "Reprod_Research_Assignment2.Rmd",
    "properties" : {
        "ignored_words" : "dataframe,i,etc,PROPDamage\n",
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}